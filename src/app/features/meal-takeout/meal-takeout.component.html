<div class="container">
  <header class="page-header">
    <h1 id="page-title">{{ sharedDataService.title }} - Takeout Options</h1>
    <p id="page-description">{{ sharedDataService.description }}</p>
  </header>

  <main class="page-content">
    <div class="highlight-section takeout-explanation">
      <p>5 minutes isn't enough time to cook. Let's find takeout options near you!</p>
    </div>

    <div class="action-section" *ngIf="!isLoading && restaurants.length === 0">
      <button
        mat-raised-button
        color="primary"
        class="find-restaurants-button"
        (click)="findNearbyRestaurants()"
      >
        Find Restaurants Near Me
      </button>
    </div>

    <div class="loading-section" *ngIf="isLoading">
      <mat-spinner></mat-spinner>
      <p class="loading-message">{{ loadingMessage }}</p>
    </div>

    <div class="error-section" *ngIf="errorMessage && !isLoading">
      <p class="error-message">{{ errorMessage }}</p>
    </div>

    <!-- Show when search completed but found 0 restaurants -->
    <div
      class="error-section"
      *ngIf="hasSearched && !isLoading && restaurants.length === 0 && !errorMessage"
    >
      <p class="error-message">No restaurants found.</p>
    </div>

    <div class="manual-location-section" *ngIf="showManualLocationInput && !isLoading">
      <form [formGroup]="locationForm" (ngSubmit)="searchByManualLocation()">
        <mat-form-field appearance="outline">
          <mat-label>Enter your location</mat-label>
          <input matInput formControlName="manualLocation" placeholder="e.g., New York, NY" />
          <mat-error *ngIf="locationForm.get('manualLocation')?.hasError('required')">
            Location is required
          </mat-error>
          <mat-error *ngIf="locationForm.get('manualLocation')?.hasError('minlength')">
            Please enter at least 2 characters
          </mat-error>
        </mat-form-field>
        <button mat-raised-button color="primary" type="submit" [disabled]="locationForm.invalid">
          Search Restaurants
        </button>
      </form>
    </div>

    <div class="restaurants-section" *ngIf="restaurants.length > 0 && !isLoading">
      <h2>Nearby Restaurants ({{ restaurants.length }} found)</h2>

      <div
        class="search-context"
        *ngIf="
          getIngredientsDisplay() ||
          getCuisinePreferencesDisplay().length > 0 ||
          getDietaryRestrictionsDisplay().length > 0
        "
      >
        <p *ngIf="getIngredientsDisplay()">
          <strong>Looking for:</strong> {{ getIngredientsDisplay() }}
        </p>
        <p *ngIf="getCuisinePreferencesDisplay().length > 0">
          <strong>Cuisine:</strong> {{ getCuisinePreferencesDisplay().join(', ') }}
        </p>
        <p *ngIf="getDietaryRestrictionsDisplay().length > 0">
          <strong>Dietary:</strong> {{ getDietaryRestrictionsDisplay().join(', ') }}
        </p>
      </div>

      <button
        mat-raised-button
        color="primary"
        (click)="findNearbyRestaurants()"
        class="search-again-button"
      >
        Search Again
      </button>

      <div class="restaurant-list">
        <div class="restaurant-card" *ngFor="let restaurant of restaurants">
          <h3>{{ restaurant.name }}</h3>
          <p class="address">{{ restaurant.vicinity }}</p>
          <div class="restaurant-details">
            <span class="rating" *ngIf="restaurant.rating"> ⭐ {{ restaurant.rating }} </span>
            <span class="price-level" *ngIf="restaurant.price_level">
              {{ '$'.repeat(restaurant.price_level) }}
            </span>
            <span class="types" *ngIf="restaurant.types && restaurant.types.length > 0">
              {{ restaurant.types.join(', ') }}
            </span>
          </div>
          <div class="opening-hours" *ngIf="restaurant.opening_hours">
            <small>Hours: {{ restaurant.opening_hours }}</small>
          </div>
        </div>
      </div>
    </div>

    <div class="back-section">
      <button mat-button (click)="backToForm()">← Back to Meal Form</button>
    </div>
  </main>
</div>
